jQuery(i=>{const n={LOADING:1,FINISHED:2};const r={1:["dy.","day"],7:["wk.","week"],30:["mo.","month"]};new PPVue({el:"#pp-app",data:{statusRequest:n,reqStatus:n.LOADING,i18n:pp_plans.i18n,chosenPlanId:null,isOpenModal:false,isOpenRatingModal:false,isOpenFeedbackModal:false,planId:null,quota:0,quotaUsed:0,summary:"",planName:"Unknown",expiredDate:"",isUnlimitedPlan:false,plans:[],urlLoginDashboard:null,selectedRating:0,fbMsg:"",fbEmail:pp_plans.user_email,isSendingFeedback:false},created(){this.getPlans()},methods:{getPlans(){i.get(ajaxurl,{action:"pp_get_plan",_ajax_nonce:pp_plans.read_nonce},e=>{if(e.success){const a=e.data;if(a){this.planId=a.current_plan.pid||null;const t=new RegExp("((\ud83c[\udc00-\udfff])|(\ud83d[\udc00-\udfff])|(\ud83e[\udd00-\uddff])|[☀-⭕])","g");this.plans=a.data.map(e=>{if(!e.title){if(e.price&&r[e.cycle]){e.name+=` $${Math.round(e.price/100)}/${r[e.cycle][0]}`}e.title=e.name}e.title=e.title.replace(t,'<i class="pp-emj">$1</i>');e.loading=false;return e});if(this.planId){this.quota=a.current_plan.quota||0;this.quotaUsed=a.current_plan.quota_used||0;this.expiredDate=a.current_plan.expired_date||"";this.isUnlimitedPlan=!!a.current_plan.is_unlimited_plan;if(this.currentPlan){this.planName=this.currentPlan.name||"Unknown";const s=this.currentPlan.cycle||0;this.summary=r[s]?`${this.quota} quota per ${r[s][1]}`:"Unknown"}}this.urlLoginDashboard=a.url_login_dashboard||null}else{i.toastr.error("The ParcelPanel server is busy. Please try again later!")}this.reqStatus=n.FINISHED}else{i.toastr.error(e.msg)}},"json")},getPlanLink(e){i.ajax({url:ajaxurl,data:{action:"pp_get_plan_link",_ajax_nonce:pp_plans.link_nonce,pid:e},dataType:"json",success:e=>{if(e.success){this.openNewTab(e.data.link)}else{i.toastr.error(e.msg)}},error(){i.toastr.error("Server error, please try again or refresh the page")}})},choosePlan(a,e=false){const t=this.plans.find(e=>a===e.id);if(!t){return}if(!e&&1===a){this.isOpenModal=true;return}if(t.is_unlimited_quota){this.onChooseUnlimitedPlan();return}this.chosenPlanId=a;this.getPlanLink(a)},freeOk(){i.post(ajaxurl,{action:"pp_drop_free_ajax",_ajax_nonce:pp_plans.read_nonce},e=>{if(e.success){i.toastr.success(e.msg||"Updated successfully");this.isOpenModal=false;setTimeout(()=>{location.reload()},300)}else{i.toastr.error(e.msg||"Updated failed")}},"json")},onChooseUnlimitedPlan(){window.PPLiveChat("showNewMessage","Hi support, I would like to free upgrade to the Unlimited plan.")},openNewTab(e){window.open(e)},onNeedAnyHelpClick(){window.PPLiveChat("showNewMessage","")},onRatingClick(e){this.selectedRating=e;if(5===e){const a="https://wordpress.org/support/plugin/parcelpanel/reviews/#new-post";const t=i('<a href="'+a+'" target="_blank"></a>');const s=t.get(0);if(document.createEvent){const n=document.createEvent("MouseEvents");n.initEvent("click",true,true);s.dispatchEvent(n);t.remove()}else if(document.all){s.click()}}else{this.isOpenFeedbackModal=true}},onSendFeedback(){let e={action:"pp_feedback_confirm",_ajax_nonce:pp_plans.feedback_confirm_nonce,msg:this.fbMsg,email:this.fbEmail,rating:this.selectedRating,type:2};this.isSendingFeedback=true;i.ajax({url:ajaxurl,data:e,type:"POST",complete(){this.isSendingFeedback=false},success:function(e){if(e.success){this.isOpenRatingModal=false;this.isOpenFeedbackModal=false;let e="Sent successfully";i.toastr.success(e);setTimeout(()=>{location.reload()},300)}else{i.toastr.error(e.msg)}},error(){let e="Server error, please try again or refresh the page";i.toastr.error(e)}})}},computed:{currentPlan(){return this.plans.find(e=>e.id===this.planId)},quotaRemain(){return this.quota-this.quotaUsed},quotaProgressWidth(){return this.quota?100-this.quotaUsed/this.quota*100:0}}})});