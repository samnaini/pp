jQuery(a=>{new PPVue({el:"#pp-app",data:{parcelpanel:parcelpanel_param,pageParam:pp_param,orderStatusList:[],couriers:pp_courier_config,searchKeyword:"",isShowDisabled:true,isSearching:false,courierListLoading:false,enabledList:[],disabledList:[],showResultList:[],isSelectAll:false,selectAllList:[],count:0,page:0,pageSize:20,viewNum:0,emailNotificationAddTrackingSection:false,trackingSectionOrderStatus:pp_setting_config.tracking_section_order_status,emailNotifications:pp_setting_config.email_notification,emailNotificationsDisabled:{in_transit:false,out_for_delivery:false,delivered:false,exception:false,failed_attempt:false,email_notification_add_tracking_section:false,orders_page_add_track_button:false,status_shipped:false,admin_order_actions_add_track:false},ordersPageAddTrackButton:pp_setting_config.orders_page_add_track_button,trackButtonOrderStatus:pp_setting_config.track_button_order_status,isStatusShipped:pp_setting_config.status_shipped,adminOrderActionsAddTrack:pp_setting_config.admin_order_actions_add_track,adminOrderActionsAddTrackOrderStatus:pp_setting_config.admin_order_actions_add_track_order_status,tmpEnabledExpressList:[],tmpDisabledExpressList:[],isOpenViewExampleModalOrderTrackButton:false,isOpenViewExampleModalAdminOrdersAddTrackButton:false},created(){const t=pp_setting_config.order_status;for(const s in t){this.orderStatusList.push({label:t[s],id:s})}this.isShowDisabled=0===this.couriers.enable.length;this.enabledList=this.couriers.enable;this.disabledList=this.couriers.disable;this.emailNotificationAddTrackingSection=pp_setting_config.email_notification_add_tracking_section;this.ordersPageAddTrackButton=pp_setting_config.orders_page_add_track_button;this.changeTrackingSectionOrderStatus=debounce(this.saveTrackingSectionOrderStatus,1e3);this.changeTrackButtonOrderStatus=debounce(this.saveTrackButtonOrderStatus,1e3);this.changeAdminOrderActionsAddTrackOrderStatus=debounce(this.saveAdminOrderActionsAddTrackOrderStatus,1e3);this.changeCourierSearchInput=debounce(this.searchExpress,200);this.dbncSaveCourierMatching=debounce(this.courierMatchingSave,1e3)},watch:{isShowDisabled(t){this.isShowTaggle()}},computed:{listTotal(){if(this.isShowDisabled&&!this.isSearching){return this.disabledList.length}return this.showResultList.length},resultList(){if(this.isSearching){return this.showResultList}if(!this.isShowDisabled){return this.enabledList}const t=this.page*this.pageSize;return this.disabledList.slice(t,t+this.pageSize)},trackingSectionOrderStatusList(){return this.orderStatusList.filter(t=>!["wc-pending","wc-on-hold","wc-checkout-draft"].includes(t.id))},trackButtonOrderStatusList(){return this.orderStatusList.filter(({id:t})=>!["wc-pending","wc-on-hold"].includes(t))}},methods:{debounce:debounce,selectMatchItem(t,s){const e=new RegExp(s,"gi");return t.filter(t=>{if(e.test(t.express)||e.test(t.name)){return true}})},searchExpress(t){this.searchKeyword=t;this.isSearching=0<t.trim().length;if(!this.isSearching){return}this.showResultList=this.selectMatchItem(this.isShowDisabled?this.disabledList:this.enabledList,t)},isShowTaggle(){this.page=0;this.searchExpress("");this.initSelectList(this.resultList);this.count=0;this.isSelectAll=false},initSelectList(t){t.forEach(t=>{this.selectAllList[t.express]=false})},enabledControlData(s){this.resultList.forEach(t=>{this.enabledCheckboxValueChange(t.express,s)});if(!s){this.count=0}else{this.count=this.resultList.length}},disabledControlData(s){this.resultList.forEach(t=>{this.disabledCheckboxValueChange(t.express,s)});if(!s){this.count=0}else{this.count=this.resultList.length}},enabledCheckboxValueChange(t,s){if(!s){this.count--}else{this.count++}this.selectAllList[t]=s;PPVue.set(this.selectAllList,t,this.selectAllList[t]);this.isSelectAll=true;for(const e in this.selectAllList){if(!this.selectAllList[e]){this.isSelectAll=false;break}}},disabledCheckboxValueChange(t,s){if(!s){this.count--}else{this.count++}this.selectAllList[t]=s;PPVue.set(this.selectAllList,t,this.selectAllList[t]);this.isSelectAll=true;for(const e in this.selectAllList){if(!this.selectAllList[e]){this.isSelectAll=false;break}}},swapPos(t,s){const e=this.resultList[t].express;const i=this.resultList[s].express;const a=this.enabledList.findIndex(t=>e===t.express);const r=this.enabledList.findIndex(t=>i===t.express);this.swapArrayData(this.enabledList,a,r);if(this.isSearching){this.swapArrayData(this.showResultList,t,s)}this.tmpEnabledExpressList=this.enabledList.map(t=>t.express);this.dbncSaveCourierMatching()},swapArrayData(t,s,e){[t[s],t[e]]=[t[e],t[s]];PPVue.set(t,s,t[s]);PPVue.set(t,e,t[e])},enableExpress(s,t=true){const e=this.disabledList.findIndex(t=>s===t.express);if(-1===e){return false}if(this.disabledList[e]&&this.count>0){this.count--}const i=this.disabledList.splice(e,1);this.enabledList.push(i[0]);delete this.selectAllList[s];if(this.isSearching){const e=this.showResultList.findIndex(t=>s===t.express);if(-1!==e){this.showResultList.splice(e,1);if(!this.showResultList.length){this.searchExpress("")}}}if(!this.selectAllList.length){this.isSelectAll=false}this.tmpEnabledExpressList.push(s);t&&this.courierMatchingSave()},enableMoreExpress(){let t=false;for(const s in this.selectAllList){if(this.selectAllList[s]){t=true;this.enableExpress(s,false)}}t&&this.courierMatchingSave();this.count=0},disableMoreExpress(){const t=[];for(const s in this.selectAllList){if(this.selectAllList[s]){t.push(s);const e=this.enabledList.findIndex(t=>s===t.express);const i=this.enabledList.splice(e,1);this.disabledList.push(i[0]);delete this.selectAllList[s];if(this.isSearching){const e=this.showResultList.findIndex(t=>s===t.express);this.showResultList.splice(e,1);if(!this.showResultList.length){this.searchExpress("")}}}}if(!this.selectAllList.length){this.isSelectAll=false}this.count=0;if(t){this.tmpDisabledExpressList=[...this.tmpDisabledExpressList,...t];this.courierMatchingSave()}this.disabledList.sort((t,s)=>{const e=parseInt(t.sort);const i=parseInt(s.sort);return e>i?1:e<i?-1:0})},changePages(t){this.page+=t;this.viewNum=20},saveTrackingSectionOrderStatus(){if(this.trackingSectionOrderStatus.length<1){this.emailNotificationAddTrackingSection=false}this.settingsSave({tracking_section_order_status:this.trackingSectionOrderStatus})},saveTrackButtonOrderStatus(){if(this.trackButtonOrderStatus.length<1){this.ordersPageAddTrackButton=false}this.settingsSave({track_button_order_status:this.trackButtonOrderStatus})},saveAdminOrderActionsAddTrackOrderStatus(){if(this.adminOrderActionsAddTrackOrderStatus.length<1){this.adminOrderActionsAddTrack=false}this.settingsSave({admin_order_actions_add_track_order_status:this.adminOrderActionsAddTrackOrderStatus})},saveEmailNotificationSwitch(t){this.emailNotificationsDisabled[t]=true;this.settingsSave({email_notification:{[t]:this.emailNotifications[t]}},{complete:()=>{this.emailNotificationsDisabled[t]=false},error:()=>{this.emailNotifications[t]=!this.emailNotifications[t]}})},saveEmailNotificationAddTrackingSection(){this.emailNotificationsDisabled.email_notification_add_tracking_section=true;this.settingsSave({email_notification_add_tracking_section:this.emailNotificationAddTrackingSection},{complete:()=>{this.emailNotificationsDisabled.email_notification_add_tracking_section=false},error:()=>{this.emailNotificationAddTrackingSection=!this.emailNotificationAddTrackingSection}})},saveOrdersPageAddTrackButton(){this.emailNotificationsDisabled.orders_page_add_track_button=true;this.settingsSave({orders_page_add_track_button:this.ordersPageAddTrackButton},{complete:()=>{this.emailNotificationsDisabled.orders_page_add_track_button=false},error:()=>{this.ordersPageAddTrackButton=!this.ordersPageAddTrackButton}})},saveIsStatusShipped(){this.emailNotificationsDisabled.status_shipped=true;this.settingsSave({status_shipped:this.isStatusShipped},{complete:()=>{this.emailNotificationsDisabled.status_shipped=false},error:()=>{this.isStatusShipped=!this.isStatusShipped}})},saveAdminOrderActionsAddTrack(){this.emailNotificationsDisabled.admin_order_actions_add_track=true;this.settingsSave({admin_order_actions_add_track:this.adminOrderActionsAddTrack},{complete:()=>{this.emailNotificationsDisabled.admin_order_actions_add_track=false},error:()=>{this.adminOrderActionsAddTrack=!this.adminOrderActionsAddTrack}})},settingsSave(t,{complete:s,success:e,error:i}={}){a.ajax({type:"POST",url:`${ajaxurl}?action=pp_settings_save&_ajax_nonce=${pp_settings_save_nonce}`,contentType:"application/json",data:JSON.stringify(t),complete:()=>{s?.()},success:t=>{if(t.success){a.toastr.success(t.msg)}else{a.toastr.error(t.msg)}e?.()},error(){a.toastr.error("Server error, please try again or refresh the page");i?.()}})},courierMatchingSave(){this.courierListLoading=true;const t={enable:this.tmpEnabledExpressList,disable:this.tmpDisabledExpressList};this.tmpEnabledExpressList=[];this.tmpDisabledExpressList=[];a.ajax({type:"POST",url:ajaxurl,data:{...t,action:"pp_courier_matching_save",_ajax_nonce:pp_courier_matching_save_nonce},complete:()=>{this.courierListLoading=false},success:t=>{if(t.success){a.toastr.success(t.msg)}else{a.toastr.error(t.msg)}},error(){a.toastr.error("Server error, please try again or refresh the page")}})}}})});